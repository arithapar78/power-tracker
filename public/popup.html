<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Energy Tracking App</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container" data-theme="light">
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Switch theme">
      <span class="theme-icon">üåô</span>
    </button>

    <!-- Header -->
    <header class="popup-header">
      <div class="logo-container">
        <img src="icon-48.png" alt="Power AI Power Tracker Logo" class="logo" id="popupLogo">
        <h1>Power AI</h1>
      </div>
      <div class="status-indicator" id="statusIndicator">
        <span class="status-dot" id="statusDot" role="status" aria-live="polite"></span>
        <span class="status-text" id="statusText">Loading...</span>
      </div>
    </header>

    <!-- Current Power Display -->
    <section class="current-power">
      <div class="power-display-container">
        <div class="power-display" id="powerDisplay">
          <div class="power-value" id="powerValue">--</div>
          <div class="power-label">Current Power</div>
        </div>
        <!-- Enhanced Energy Mode Toggle -->
        <div class="energy-mode-toggle" role="tablist" aria-label="Energy tracking mode selection">
          <button
            class="toggle-btn"
            id="frontendModeBtn"
            data-mode="frontend"
            role="tab"
            aria-selected="false"
            aria-controls="energy-display"
            tabindex="-1"
            title="Track only browser/frontend energy consumption">
            <span class="btn-text">Browser Power</span>
          </button>
          <button
            class="toggle-btn active"
            id="totalModeBtn"
            data-mode="total"
            role="tab"
            aria-selected="true"
            aria-controls="energy-display"
            tabindex="0"
            title="Track total energy including backend/AI processing">
            <span class="btn-icon">‚ö°</span>
            <span class="btn-text">Browser + Backend</span>
          </button>
        </div>
        <div class="power-description" id="powerDescription">
          Calculating power consumption...
        </div>
        <div class="efficiency-rating" id="efficiencyRating">
          <span class="efficiency-badge" id="efficiencyBadge">--</span>
          <span class="efficiency-text">Efficiency</span>
        </div>
      </div>
    </section>

    <!-- Enhanced Environmental Impact -->
    <section class="device-comparisons">
      <h2>Environmental Impact</h2>
      <div class="comparison-grid">
        <div class="comparison-card bulbs-comparison main-comparison">
          <div class="comparison-icon">üí°</div>
          <div class="comparison-content">
            <div class="comparison-percentage" id="bulbsCount">--</div>
            <div class="comparison-label">LED bulbs powered</div>
          </div>
        </div>
        <div class="comparison-card water-comparison">
          <div class="comparison-icon">üíß</div>
          <div class="comparison-content">
            <div class="comparison-percentage" id="waterUsage">--</div>
            <div class="comparison-label">gallons of water per hour</div>
          </div>
        </div>
        <div class="comparison-card carbon-comparison">
          <div class="comparison-icon">üåç</div>
          <div class="comparison-content">
            <div class="comparison-percentage" id="carbonEmissions">--</div>
            <div class="comparison-label">CO‚ÇÇ per hour</div>
          </div>
        </div>
      </div>
      
      <!-- Sustainability Score -->
      <div class="sustainability-score" id="sustainabilitySection" style="display: none;">
        <div class="score-container">
          <div class="score-value" id="sustainabilityScore">--</div>
          <div class="score-label">Sustainability Score</div>
          <div class="score-description" id="sustainabilityDescription">Calculating...</div>
        </div>
      </div>
    </section>


    <!-- AI Model Information Section -->
    <section class="ai-model-info-section" id="aiModelInfoSection">
      <h2>ü§ñ AI Model Information</h2>
      <div class="ai-model-card">
        <div class="model-details">
          <div class="model-name-display">
            <div class="model-name-value" id="currentModelName">Claude Sonnet 4</div>
            <div class="model-version" id="currentModelVersion">20250514</div>
          </div>
          <div class="energy-usage-info">
            <div class="energy-metric">
              <span class="energy-label">Current Session Energy:</span>
              <span class="energy-value" id="sessionEnergyUsage">~2.5 Wh</span>
            </div>
            <div class="energy-metric">
              <span class="energy-label">Estimated Carbon:</span>
              <span class="energy-value" id="sessionCarbonUsage">~1.2 gCO‚ÇÇe</span>
            </div>
            <div class="energy-metric">
              <span class="energy-label">Model Efficiency:</span>
              <span class="energy-value efficiency-good" id="modelEfficiency">High</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Active Tab Info -->
    <section class="current-tab">
      <h2>Current Tab</h2>
      <div class="tab-info" id="currentTabInfo">
        <div class="tab-title" id="tabTitle">Loading...</div>
        <div class="tab-url" id="tabUrl">...</div>
        <div class="tab-metrics">
          <div class="metric">
            <span class="metric-label">DOM Nodes:</span>
            <span class="metric-value" id="domNodes">--</span>
          </div>
          <div class="metric">
            <span class="metric-label">Active Time:</span>
            <span class="metric-value" id="activeTime">--</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Tab Energy Recommendations -->
    <section class="tab-energy-recommendations" id="tabEnergyRecommendations" style="display: none;">
      <h2>üí° Energy Saving Suggestions</h2>
      
      <!-- High Energy Tabs -->
      <div class="high-energy-tabs" id="highEnergyTabsSection" style="display: none;">
        <div class="recommendation-header">
          <span class="recommendation-icon">‚ö°</span>
          <span class="recommendation-title">These tabs are using the most energy:</span>
        </div>
        <div class="high-energy-list" id="highEnergyTabsList">
          <!-- High energy tabs will be populated here -->
        </div>
      </div>

      <!-- Tab Closing Suggestions -->
      <div class="tab-closing-suggestions" id="tabClosingSuggestions" style="display: none;">
        <div class="recommendation-header">
          <span class="recommendation-icon">üóÇÔ∏è</span>
          <span class="recommendation-title">Consider closing tabs:</span>
        </div>
        <div class="closing-suggestions-list" id="closingSuggestionsList">
          <!-- Tab closing suggestions will be populated here -->
        </div>
        <div class="suggestion-actions">
          <button class="btn btn-small btn-primary" id="closeRecommendedBtn">Close Suggested Tabs</button>
          <button class="btn btn-small btn-secondary" id="dismissSuggestionsBtn">Dismiss</button>
        </div>
      </div>

      <!-- Energy Summary -->
      <div class="energy-summary" id="energySummarySection" style="display: none;">
        <div class="summary-card">
          <div class="summary-icon">üìä</div>
          <div class="summary-content">
            <div class="summary-stat">
              <span class="summary-value" id="totalTabsCount">--</span>
              <span class="summary-label">Total Tabs</span>
            </div>
            <div class="summary-stat">
              <span class="summary-value" id="highEnergyCount">--</span>
              <span class="summary-label">High Energy</span>
            </div>
            <div class="summary-stat">
              <span class="summary-value" id="potentialSavings">--</span>
              <span class="summary-label">Potential Savings</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Quick Stats -->
    <section class="quick-stats">
      <h2>Today's Summary</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalTabs">--</div>
          <div class="stat-label">Tabs Tracked</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgPower">--</div>
          <div class="stat-label">Avg Power</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="highPowerAlerts">--</div>
          <div class="stat-label">High Power</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalTime">--</div>
          <div class="stat-label">Active Time</div>
        </div>
      </div>
    </section>

    <!-- Power Saving Tips -->
    <section class="tips-section" id="tipsSection" style="display: none;">
      <h2>üí° Power Saving Tips</h2>
      <div class="tip-card" id="powerTip">
        <div class="tip-text"></div>
        <button class="tip-action" id="tipAction">Apply</button>
      </div>
    </section>

    <!-- Action Buttons -->
    <section class="actions">
      <button class="btn btn-primary" id="viewHistoryBtn">View History</button>
      <button class="btn btn-secondary" id="settingsBtn">Settings</button>
      <button class="btn btn-advanced" id="advancedFeaturesBtn" title="Access advanced features">‚ö°</button>
    </section>

    <!-- Code Entry Modal -->
    <div class="modal-overlay" id="codeEntryModal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Access Advanced Features</h3>
          <button class="modal-close" id="modalCloseBtn">&times;</button>
        </div>
        <div class="modal-body">
          <p>Enter access code to unlock prompt optimization features:</p>
          <input type="password" id="accessCodeInput" class="code-input" placeholder="Enter code" maxlength="4">
          <div class="code-error" id="codeError" style="display: none;">Invalid access code</div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-primary" id="submitCodeBtn">Submit</button>
          <button class="btn btn-secondary" id="cancelCodeBtn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Prompt Generator Section (Hidden by default) -->
    <section class="prompt-generator" id="promptGeneratorSection" style="display: none;">
      <div class="generator-header">
        <h2>‚ö° Prompt Energy Optimizer</h2>
        <button class="generator-close" id="generatorCloseBtn">&times;</button>
      </div>
      
      <!-- Generator Stats -->
      <div class="generator-stats">
        <div class="stat-item">
          <span class="stat-value" id="totalPromptsGenerated">0</span>
          <span class="stat-label">Prompts Generated</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="energySavingsPercent">0%</span>
          <span class="stat-label">Energy Saved</span>
        </div>
        <div class="stat-item">
          <span class="stat-value" id="avgTokenReduction">0</span>
          <span class="stat-label">Avg Token Reduction</span>
        </div>
      </div>

      <!-- Generator Controls -->
      <div class="generator-controls">
        <div class="control-group">
          <label for="optimizationLevel">Optimization Level:</label>
          <select id="optimizationLevel" class="form-select">
            <option value="balanced">Balanced</option>
            <option value="aggressive">Aggressive</option>
            <option value="conservative">Conservative</option>
          </select>
        </div>
        
        <div class="control-group">
          <label for="targetModel">Target Model:</label>
          <select id="targetModel" class="form-select">
            <option value="gpt-4">GPT-4</option>
            <option value="gpt-3.5">GPT-3.5</option>
            <option value="claude">Claude</option>
            <option value="gemini">Gemini</option>
          </select>
        </div>

        <div class="control-group full-width">
          <label for="promptInput">Enter your prompt:</label>
          <textarea id="promptInput" class="prompt-textarea" placeholder="Enter your prompt here..." rows="4"></textarea>
        </div>

        <!-- Real-time Token Analysis Panel -->
        <div class="token-analysis-panel">
          <div class="analysis-header">
            <h4>üìä Real-time Token Analysis</h4>
            <div class="analysis-toggle">
              <button class="toggle-detailed-analysis" id="toggleDetailedAnalysis">Show Details</button>
            </div>
          </div>

          <div class="token-metrics-grid">
            <!-- Original Prompt Metrics -->
            <div class="token-metrics original-metrics">
              <div class="metrics-header">
                <h5>Original Prompt</h5>
                <div class="prompt-status">Live</div>
              </div>
              
              <div class="basic-counts">
                <div class="count-item">
                  <span class="count-value" id="originalCharCount">0</span>
                  <span class="count-label">Characters</span>
                </div>
                <div class="count-item">
                  <span class="count-value" id="originalWordCount">0</span>
                  <span class="count-label">Words</span>
                </div>
              </div>

              <div class="token-counts">
                <div class="token-count-item primary">
                  <span class="token-icon">ü§ñ</span>
                  <span class="token-value" id="originalGptTokens">0</span>
                  <span class="token-label">GPT Tokens</span>
                </div>
                <div class="token-count-item">
                  <span class="token-icon">üß†</span>
                  <span class="token-value" id="originalClaudeTokens">0</span>
                  <span class="token-label">Claude Tokens</span>
                </div>
              </div>

              <div class="efficiency-metrics">
                <div class="efficiency-item">
                  <span class="efficiency-label">Efficiency:</span>
                  <span class="efficiency-value" id="originalTokenEfficiency">--</span>
                </div>
                <div class="wattage-item">
                  <span class="wattage-icon">‚ö°</span>
                  <span class="wattage-value" id="originalWattageEstimate">0 mWh</span>
                </div>
              </div>

              <div class="analysis-insights">
                <div class="insights-text" id="originalTokenInsights">Start typing to see analysis...</div>
              </div>
            </div>

            <!-- Optimized Prompt Metrics -->
            <div class="token-metrics optimized-metrics" style="opacity: 0.5;">
              <div class="metrics-header">
                <h5>Optimized Prompt</h5>
                <div class="prompt-status pending">Pending</div>
              </div>
              
              <div class="basic-counts">
                <div class="count-item">
                  <span class="count-value" id="optimizedCharCount">0</span>
                  <span class="count-label">Characters</span>
                </div>
                <div class="count-item">
                  <span class="count-value" id="optimizedWordCount">0</span>
                  <span class="count-label">Words</span>
                </div>
              </div>

              <div class="token-counts">
                <div class="token-count-item primary">
                  <span class="token-icon">ü§ñ</span>
                  <span class="token-value" id="optimizedGptTokens">0</span>
                  <span class="token-label">GPT Tokens</span>
                </div>
                <div class="token-count-item">
                  <span class="token-icon">üß†</span>
                  <span class="token-value" id="optimizedClaudeTokens">0</span>
                  <span class="token-label">Claude Tokens</span>
                </div>
              </div>

              <div class="efficiency-metrics">
                <div class="efficiency-item">
                  <span class="efficiency-label">Efficiency:</span>
                  <span class="efficiency-value" id="optimizedTokenEfficiency">--</span>
                </div>
                <div class="wattage-item">
                  <span class="wattage-icon">‚ö°</span>
                  <span class="wattage-value" id="optimizedWattageEstimate">0 mWh</span>
                </div>
              </div>

              <div class="analysis-insights">
                <div class="insights-text" id="optimizedTokenInsights">Awaiting optimization...</div>
              </div>
            </div>
          </div>

          <!-- Token Comparison Section -->
          <div class="token-comparison-section" id="tokenComparisonSection" style="display: none;">
            <div class="comparison-header">
              <h4>üîÑ Optimization Comparison</h4>
              <div class="comparison-summary">
                <div class="summary-metric highlight">
                  <span class="metric-icon">üìâ</span>
                  <span class="metric-value" id="tokensSaved">--</span>
                  <span class="metric-label">Tokens Saved</span>
                </div>
                <div class="summary-metric">
                  <span class="metric-icon">üìä</span>
                  <span class="metric-value" id="percentReduction">--%</span>
                  <span class="metric-label">Reduction</span>
                </div>
                <div class="summary-metric">
                  <span class="metric-icon">üí∞</span>
                  <span class="metric-value" id="costSavings">$--</span>
                  <span class="metric-label">Cost Savings</span>
                </div>
                <div class="summary-metric">
                  <span class="metric-icon">‚≠ê</span>
                  <span class="metric-value" id="optimizationQualityScore">--/100</span>
                  <span class="metric-label">Quality Score</span>
                </div>
              </div>
            </div>

            <!-- Detailed Comparison Analysis -->
            <div class="detailed-comparison" id="detailedComparisonPanel" style="display: none;">
              <div class="comparison-tabs">
                <button class="comparison-tab active" data-tab="overview">Overview</button>
                <button class="comparison-tab" data-tab="changes">Changes</button>
                <button class="comparison-tab" data-tab="efficiency">Efficiency</button>
              </div>

              <div class="comparison-content">
                <!-- Overview Tab -->
                <div class="tab-content active" id="overviewTab">
                  <div class="comparison-charts">
                    <div class="chart-container">
                      <h5>Token Distribution</h5>
                      <div class="token-bars">
                        <div class="token-bar original">
                          <span class="bar-label">Original</span>
                          <div class="bar-fill" id="originalTokenBar"></div>
                          <span class="bar-value" id="originalTokenBarValue">--</span>
                        </div>
                        <div class="token-bar optimized">
                          <span class="bar-label">Optimized</span>
                          <div class="bar-fill" id="optimizedTokenBar"></div>
                          <span class="bar-value" id="optimizedTokenBarValue">--</span>
                        </div>
                      </div>
                    </div>

                    <div class="chart-container">
                      <h5>Wattage Impact</h5>
                      <div class="wattage-comparison">
                        <div class="wattage-before">
                          <span class="wattage-label">Before</span>
                          <span class="wattage-value" id="wattageBefore">-- mWh</span>
                        </div>
                        <div class="wattage-arrow">‚Üí</div>
                        <div class="wattage-after">
                          <span class="wattage-label">After</span>
                          <span class="wattage-value" id="wattageAfter">-- mWh</span>
                        </div>
                        <div class="wattage-savings">
                          <span class="savings-value" id="wattageSavings">-- mWh</span>
                          <span class="savings-label">saved</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Changes Tab -->
                <div class="tab-content" id="changesTab">
                  <div class="changes-analysis">
                    <div class="removed-words-section">
                      <h5>üóëÔ∏è Removed Words</h5>
                      <div class="removed-words-list" id="removedWordsList">
                        <span class="no-changes">No analysis yet</span>
                      </div>
                    </div>

                    <div class="restructured-sentences-section">
                      <h5>üìù Restructured Sentences</h5>
                      <div class="restructured-sentences-list" id="restructuredSentencesList">
                        <div class="no-changes">No analysis yet</div>
                      </div>
                    </div>

                    <div class="optimization-techniques">
                      <h5>üîß Applied Techniques</h5>
                      <div class="techniques-list" id="appliedTechniquesList">
                        <div class="no-changes">No optimization performed yet</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Efficiency Tab -->
                <div class="tab-content" id="efficiencyTab">
                  <div class="efficiency-analysis">
                    <div class="efficiency-scores">
                      <div class="score-item">
                        <span class="score-label">Token Efficiency</span>
                        <span class="score-value" id="tokenEfficiencyScore">--%</span>
                        <div class="score-bar">
                          <div class="score-fill" id="tokenEfficiencyBar"></div>
                        </div>
                      </div>
                      <div class="score-item">
                        <span class="score-label">Readability Retained</span>
                        <span class="score-value" id="readabilityScore">--%</span>
                        <div class="score-bar">
                          <div class="score-fill" id="readabilityBar"></div>
                        </div>
                      </div>
                      <div class="score-item">
                        <span class="score-label">Meaning Preservation</span>
                        <span class="score-value" id="meaningScore">--%</span>
                        <div class="score-bar">
                          <div class="score-fill" id="meaningBar"></div>
                        </div>
                      </div>
                    </div>

                    <div class="efficiency-recommendations">
                      <h5>üí° Efficiency Recommendations</h5>
                      <div class="recommendations-list" id="efficiencyRecommendationsList">
                        <div class="no-recommendations">No recommendations available</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Power Savings Display Panel -->
        <div class="power-savings-panel" id="powerSavingsPanel" style="display: none;">
          <div class="savings-header">
            <h4>‚ö° Real-time Power Savings</h4>
            <div class="savings-toggle">
              <button class="toggle-savings-details" id="toggleSavingsDetails">Show Details</button>
            </div>
          </div>
          
          <div class="savings-summary-grid">
            <div class="savings-metric primary">
              <div class="savings-icon">‚ö°</div>
              <div class="savings-value" id="powerSavingsDisplay">No savings yet</div>
              <div class="savings-label">Power Saved</div>
            </div>
            <div class="savings-metric">
              <div class="savings-icon">üå±</div>
              <div class="savings-value" id="carbonSavingsDisplay">No savings yet</div>
              <div class="savings-label">Carbon Saved</div>
            </div>
            <div class="savings-metric">
              <div class="savings-icon">üí∞</div>
              <div class="savings-value" id="costSavingsDisplay">No savings yet</div>
              <div class="savings-label">Cost Saved</div>
            </div>
          </div>
        </div>

        <!-- Comprehensive Savings Summary Panel -->
        <div class="savings-summary-panel" id="savingsSummaryPanel" style="display: none;">
          <!-- Content will be populated by JavaScript -->
        </div>

        <!-- Advanced Quality Assessment Panel -->
        <div class="quality-assessment-panel" id="qualityAssessmentPanel" style="display: none;">
          <div class="quality-header">
            <h4>üéØ Optimization Quality Assessment</h4>
            <div class="quality-score-display">
              <div class="overall-quality-score">
                <span class="quality-value" id="overallQualityScore">--/100</span>
                <span class="quality-grade" id="qualityGrade">--</span>
              </div>
            </div>
          </div>

          <div class="quality-metrics-grid">
            <div class="quality-metric">
              <div class="metric-header">
                <span class="metric-icon">üß†</span>
                <span class="metric-name">Semantic Preservation</span>
              </div>
              <div class="metric-score">
                <span class="score-value" id="semanticPreservationScore">--%</span>
                <div class="score-bar">
                  <div class="score-fill" id="semanticPreservationBar"></div>
                </div>
              </div>
            </div>

            <div class="quality-metric">
              <div class="metric-header">
                <span class="metric-icon">üèóÔ∏è</span>
                <span class="metric-name">Structural Coherence</span>
              </div>
              <div class="metric-score">
                <span class="score-value" id="structuralCoherenceScore">--%</span>
                <div class="score-bar">
                  <div class="score-fill" id="structuralCoherenceBar"></div>
                </div>
              </div>
            </div>

            <div class="quality-metric">
              <div class="metric-header">
                <span class="metric-icon">üìù</span>
                <span class="metric-name">Linguistic Clarity</span>
              </div>
              <div class="metric-score">
                <span class="score-value" id="linguisticClarityScore">--%</span>
                <div class="score-bar">
                  <div class="score-fill" id="linguisticClarityBar"></div>
                </div>
              </div>
            </div>

            <div class="quality-metric">
              <div class="metric-header">
                <span class="metric-icon">üéØ</span>
                <span class="metric-name">Contextual Relevance</span>
              </div>
              <div class="metric-score">
                <span class="score-value" id="contextualRelevanceScore">--%</span>
                <div class="score-bar">
                  <div class="score-fill" id="contextualRelevanceBar"></div>
                </div>
              </div>
            </div>

            <div class="quality-metric">
              <div class="metric-header">
                <span class="metric-icon">‚ö°</span>
                <span class="metric-name">Token Efficiency</span>
              </div>
              <div class="metric-score">
                <span class="score-value" id="tokenEfficiencyMetricScore">--%</span>
                <div class="score-bar">
                  <div class="score-fill" id="tokenEfficiencyMetricBar"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="quality-recommendations" id="qualityRecommendations" style="display: none;">
            <div class="recommendations-header">
              <h5>üí° Quality Improvement Recommendations</h5>
            </div>
            <div class="recommendations-list" id="qualityRecommendationsList">
              <!-- Recommendations will be populated by JavaScript -->
            </div>
          </div>

          <div class="quality-confidence" id="qualityConfidence">
            <div class="confidence-display">
              <span class="confidence-label">Assessment Confidence:</span>
              <span class="confidence-value" id="confidenceScore">--%</span>
              <span class="confidence-level" id="confidenceLevel">--</span>
            </div>
          </div>
        </div>

        <!-- Optimization Insights Panel -->
        <div class="optimization-insights-panel" id="optimizationInsightsPanel" style="display: none;">
          <div class="insights-header">
            <h4>üîç Optimization Insights</h4>
            <div class="insights-toggle">
              <button class="toggle-advanced-insights" id="toggleAdvancedInsights">Show Advanced</button>
            </div>
          </div>

          <div class="insights-summary">
            <div class="insight-stat">
              <span class="stat-icon">üìä</span>
              <span class="stat-value" id="totalOptimizationsCount">--</span>
              <span class="stat-label">Total Optimizations</span>
            </div>
            <div class="insight-stat">
              <span class="stat-icon">üéØ</span>
              <span class="stat-value" id="avgTokenSavingsDisplay">--</span>
              <span class="stat-label">Avg Token Savings</span>
            </div>
            <div class="insight-stat">
              <span class="stat-icon">‚≠ê</span>
              <span class="stat-value" id="avgQualityScoreDisplay">--</span>
              <span class="stat-label">Avg Quality Score</span>
            </div>
            <div class="insight-stat">
              <span class="stat-icon">‚úÖ</span>
              <span class="stat-value" id="successRateDisplay">--%</span>
              <span class="stat-label">Success Rate</span>
            </div>
          </div>

          <div class="best-techniques-section" id="bestTechniquesSection" style="display: none;">
            <h5>üèÜ Best Performing Techniques</h5>
            <div class="techniques-ranking" id="techniquesRanking">
              <!-- Best techniques will be populated by JavaScript -->
            </div>
          </div>

          <div class="quality-trends-section" id="qualityTrendsSection" style="display: none;">
            <h5>üìà Quality Trends</h5>
            <div class="trends-display" id="trendsDisplay">
              <!-- Trends will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <button class="btn btn-primary btn-generate" id="generateOptimizedBtn">
          <span class="btn-icon">‚ö°</span>
          Generate Optimized Prompt
        </button>
      </div>

      <!-- Enhanced Results Area with Advanced Analytics -->
      <div class="results-area" id="resultsArea" style="display: none;">
        <div class="result-header">
          <h3>‚ú® Optimized Result</h3>
          <div class="energy-savings-badge">
            <span class="energy-savings" id="energySavingsResult">0% Energy Saved</span>
            <span class="carbon-savings" id="carbonSavingsResult">0g CO‚ÇÇ Saved</span>
          </div>
        </div>

        <div class="result-content">
          <div class="prompt-comparison-view">
            <div class="prompt-before-after">
              <div class="prompt-section original">
                <div class="prompt-section-header">
                  <h4>Original Prompt</h4>
                  <div class="prompt-stats">
                    <span id="originalPromptStats">-- tokens, -- chars</span>
                  </div>
                </div>
                <div class="prompt-text-container">
                  <div class="prompt-text" id="originalPromptDisplay">Your original prompt will appear here...</div>
                </div>
              </div>

              <div class="optimization-arrow">
                <div class="arrow-container">
                  <span class="arrow-icon">‚Üí</span>
                  <div class="optimization-info">
                    <span class="optimization-method" id="optimizationMethod">Balanced</span>
                    <span class="optimization-model" id="optimizationModel">GPT-4</span>
                  </div>
                </div>
              </div>

              <div class="prompt-section optimized">
                <div class="prompt-section-header">
                  <h4>Optimized Prompt</h4>
                  <div class="prompt-stats">
                    <span id="optimizedPromptStats">-- tokens, -- chars</span>
                  </div>
                </div>
                <div class="prompt-text-container">
                  <textarea id="optimizedPrompt" class="result-textarea" readonly placeholder="Optimized prompt will appear here..."></textarea>
                </div>
              </div>
            </div>

            <!-- Advanced Results Analytics -->
            <div class="results-analytics">
              <div class="analytics-tabs">
                <button class="analytics-tab active" data-tab="summary">Summary</button>
                <button class="analytics-tab" data-tab="detailed">Detailed Analysis</button>
                <button class="analytics-tab" data-tab="history">History</button>
              </div>

              <div class="analytics-content">
                <!-- Summary Tab -->
                <div class="analytics-tab-content active" id="summaryAnalytics">
                  <div class="optimization-summary">
                    <div class="summary-grid">
                      <div class="summary-card primary">
                        <div class="summary-icon">üéØ</div>
                        <div class="summary-data">
                          <span class="summary-value" id="summaryTokenReduction">--</span>
                          <span class="summary-label">Tokens Removed</span>
                        </div>
                      </div>
                      <div class="summary-card">
                        <div class="summary-icon">‚ö°</div>
                        <div class="summary-data">
                          <span class="summary-value" id="summaryWattageSaved">-- mWh</span>
                          <span class="summary-label">Energy Saved</span>
                        </div>
                      </div>
                      <div class="summary-card">
                        <div class="summary-icon">üí∞</div>
                        <div class="summary-data">
                          <span class="summary-value" id="summaryCostSaved">$--</span>
                          <span class="summary-label">Cost Savings</span>
                        </div>
                      </div>
                      <div class="summary-card">
                        <div class="summary-icon">‚≠ê</div>
                        <div class="summary-data">
                          <span class="summary-value" id="summaryQualityScore">--/100</span>
                          <span class="summary-label">Quality Score</span>
                        </div>
                      </div>
                    </div>

                    <div class="optimization-highlights">
                      <h5>üî• Key Optimizations</h5>
                      <div class="highlights-list" id="optimizationHighlights">
                        <div class="no-highlights">Generate an optimization to see highlights</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Detailed Analysis Tab -->
                <div class="analytics-tab-content" id="detailedAnalytics">
                  <div class="detailed-breakdown">
                    <div class="breakdown-section">
                      <h5>üìä Token Breakdown by Model</h5>
                      <div class="model-comparison-grid">
                        <div class="model-comparison-item">
                          <div class="model-name">GPT-4</div>
                          <div class="token-comparison">
                            <span class="before-count" id="gpt4TokensBefore">--</span>
                            <span class="arrow">‚Üí</span>
                            <span class="after-count" id="gpt4TokensAfter">--</span>
                            <span class="reduction" id="gpt4Reduction">(--%)</span>
                          </div>
                        </div>
                        <div class="model-comparison-item">
                          <div class="model-name">Claude</div>
                          <div class="token-comparison">
                            <span class="before-count" id="claudeTokensBefore">--</span>
                            <span class="arrow">‚Üí</span>
                            <span class="after-count" id="claudeTokensAfter">--</span>
                            <span class="reduction" id="claudeReduction">(--%)</span>
                          </div>
                        </div>
                        <div class="model-comparison-item">
                          <div class="model-name">Gemini</div>
                          <div class="token-comparison">
                            <span class="before-count" id="geminiTokensBefore">--</span>
                            <span class="arrow">‚Üí</span>
                            <span class="after-count" id="geminiTokensAfter">--</span>
                            <span class="reduction" id="geminiReduction">(--%)</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="breakdown-section">
                      <h5>üîç Optimization Techniques Applied</h5>
                      <div class="techniques-applied" id="techniquesApplied">
                        <div class="no-techniques">No optimization performed yet</div>
                      </div>
                    </div>

                    <div class="breakdown-section">
                      <h5>üå± Environmental Impact</h5>
                      <div class="environmental-impact">
                        <div class="impact-metric">
                          <span class="impact-icon">üîã</span>
                          <span class="impact-value" id="batteryLifeSaved">-- minutes</span>
                          <span class="impact-label">Battery Life Saved</span>
                        </div>
                        <div class="impact-metric">
                          <span class="impact-icon">üåä</span>
                          <span class="impact-value" id="waterSaved">-- drops</span>
                          <span class="impact-label">Water Saved</span>
                        </div>
                        <div class="impact-metric">
                          <span class="impact-icon">üåç</span>
                          <span class="impact-value" id="carbonFootprintReduced">-- gCO‚ÇÇ</span>
                          <span class="impact-label">Carbon Reduced</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- History Tab -->
                <div class="analytics-tab-content" id="historyAnalytics">
                  <div class="optimization-history">
                    <div class="history-header">
                      <h5>üìà Optimization History</h5>
                      <div class="history-stats">
                        <span class="total-optimizations" id="totalOptimizations">0 optimizations</span>
                        <span class="total-savings" id="totalSavings">0 tokens saved</span>
                      </div>
                    </div>
                    <div class="history-list" id="optimizationHistoryList">
                      <div class="no-history">No optimization history yet</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="result-actions enhanced">
          <div class="primary-actions">
            <button class="btn btn-secondary" id="copyResultBtn">
              <span class="btn-icon">üìã</span>
              Copy Result
            </button>
            <button class="btn btn-primary" id="newOptimizationBtn">
              <span class="btn-icon">‚ú®</span>
              New Optimization
            </button>
          </div>
          <div class="secondary-actions">
            <button class="btn btn-small btn-outline" id="shareOptimizationBtn">
              <span class="btn-icon">üì§</span>
              Share
            </button>
            <button class="btn btn-small btn-outline" id="saveOptimizationBtn">
              <span class="btn-icon">üíæ</span>
              Save
            </button>
            <button class="btn btn-small btn-outline" id="exportAnalyticsBtn">
              <span class="btn-icon">üìä</span>
              Export Analytics
            </button>
          </div>
        </div>
      </div>

      <!-- Energy Tips -->
      <div class="energy-tips">
        <h4>üí° Energy Optimization Tips</h4>
        <div class="tips-grid">
          <div class="tip-item">
            <span class="tip-icon">üéØ</span>
            <span class="tip-text">Be specific with your requirements</span>
          </div>
          <div class="tip-item">
            <span class="tip-icon">‚úÇÔ∏è</span>
            <span class="tip-text">Remove redundant instructions</span>
          </div>
          <div class="tip-item">
            <span class="tip-icon">üìä</span>
            <span class="tip-text">Use structured formats when possible</span>
          </div>
          <div class="tip-item">
            <span class="tip-icon">‚ö°</span>
            <span class="tip-text">Optimize for your target model</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Model Comparison Modal -->
    <div class="modal-overlay" id="comparisonModal" style="display: none;">
      <div class="modal-content comparison-modal">
        <div class="modal-header">
          <h3>AI Model Comparison</h3>
          <button class="modal-close" id="comparisonCloseBtn">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Comparison Controls -->
          <div class="comparison-controls">
            <div class="control-group">
              <label>Compare by:</label>
              <select id="comparisonCriteria" class="form-select">
                <option value="all">Overall</option>
                <option value="efficiency">Efficiency</option>
                <option value="sustainability">Sustainability</option>
                <option value="performance">Performance</option>
                <option value="cost">Cost</option>
              </select>
            </div>
            <div class="control-group">
              <label>Show trending:</label>
              <select id="trendingTimeframe" class="form-select">
                <option value="1d">Last 24 hours</option>
                <option value="3d">Last 3 days</option>
                <option value="7d">Last week</option>
                <option value="30d">Last month</option>
              </select>
            </div>
            <button class="btn btn-small" id="exportComparisonBtn">Export Data</button>
          </div>

          <!-- Comparison Results -->
          <div class="comparison-results" id="comparisonResults">
            <div class="loading-comparison">Loading comparison data...</div>
          </div>

          <!-- Benchmarks -->
          <div class="benchmarks-section" id="benchmarksSection" style="display: none;">
            <h4>Performance Benchmarks</h4>
            <div class="benchmark-tabs">
              <button class="tab-btn active" data-metric="intelligence">Intelligence</button>
              <button class="tab-btn" data-metric="energy">Energy</button>
              <button class="tab-btn" data-metric="carbon">Carbon</button>
              <button class="tab-btn" data-metric="performance">Speed</button>
            </div>
            <div class="benchmark-content" id="benchmarkContent">
              <div class="loading-benchmarks">Loading benchmark data...</div>
            </div>
          </div>

          <!-- Trending Models -->
          <div class="trending-section" id="trendingSection" style="display: none;">
            <h4>Trending Models</h4>
            <div class="trending-list" id="trendingList">
              <div class="loading-trending">Loading trending data...</div>
            </div>
          </div>

          <!-- Recommendations -->
          <div class="recommendations-section" id="recommendationsSection">
            <h4>üí° Recommendations</h4>
            <div class="recommendations-list" id="recommendationsList">
              <div class="loading-recommendations">Loading recommendations...</div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="refreshComparisonBtn">Refresh Data</button>
          <button class="btn btn-primary" id="applyRecommendationBtn" style="display: none;">Apply Recommendation</button>
        </div>
      </div>
    </div>

    <!-- Benchmarks Modal -->
    <div class="modal-overlay" id="benchmarksModal" style="display: none;">
      <div class="modal-content benchmarks-modal">
        <div class="modal-header">
          <h3>AI Model Benchmarks</h3>
          <button class="modal-close" id="benchmarksCloseBtn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="benchmark-controls">
            <div class="metric-selector">
              <button class="metric-btn active" data-metric="intelligence">Intelligence Index</button>
              <button class="metric-btn" data-metric="energy">Energy Efficiency</button>
              <button class="metric-btn" data-metric="carbon">Carbon Footprint</button>
              <button class="metric-btn" data-metric="water">Water Usage</button>
            </div>
          </div>
          
          <div class="benchmark-visualization" id="benchmarkVisualization">
            <!-- Benchmark charts and data will be inserted here -->
            <div class="loading-benchmarks">Loading benchmark visualization...</div>
          </div>
          
          <div class="benchmark-insights" id="benchmarkInsights">
            <h4>Key Insights</h4>
            <div class="insights-list" id="insightsList">
              <div class="loading-insights">Analyzing benchmark data...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading power consumption data...</div>
    </div>
  </div>

  <script src="enhanced-ai-energy-database.js"></script>
  <script src="enhanced-query-estimation.js"></script>
  <script src="ai-model-comparison.js"></script>
  <script src="ai-energy-database.js"></script>
  <script src="backend-power-calculator.js"></script>
  <script src="integration-tests.js"></script>
  <script src="performance-optimizer.js"></script>
  <script src="system-integration-manager.js"></script>
  <script src="system-validation.js"></script>
  <script src="popup.js"></script>
</body>
</html>